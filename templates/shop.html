
{% extends 'base.html' %}
{%load static%}
{%block title%}Products{%endblock%}
{%block content %}

{%csrf_token%}
  <!-- shop section -->

  <section class="shop_section layout_padding">
    <div class="container">
      <div class="heading_container heading_center">
        <h2>
          Latest Products
        </h2>
      </div>
      <div class="row">
        {%for product in products%}
        <div class="col-sm-6 col-md-4 col-lg-3">    
            <div class="box">
            <a href="">
              <div class="img-box">
                <img src= "{{product.IMAGE.url}}" alt="">
              </div>
              <div class="detail-box">
                <h6>
                  {{product.TITLE}}
                </h6>
               
                  <h6 ><br>
                    Price
                    <span><br>
                     â‚¹{{product.PRICE}}
                    </span>                  
                  </h6>
    
        <p  id="pro" style="display: none;">{{product.id}}</p>
                
              </div>
              <div id="adddeleteupdate" style="text-align: center;" >
                <div style="padding-top: 5px; padding-bottom:5px">
                  <button type="button" class="btn btn-primary btn-sm"><a style="color: rgb(253, 253, 253);" href="{%url 'edit' product.id %}">ADD-TO-CART </a></button>
                </div>
                  <button type="button" class="btn btn-success btn-sm"><a style="color: rgb(255, 255, 255);" href="{%url 'edit' product.id %}">Edit </a></button>
                  <button type="button"  class="btn btn-danger btn-sm"><a style="color: white;"  href="{%url 'delete' product.id %}">Delete</a></button>
      
                 </div>
               <!-- star -->
              <div class="container">
                <div class="rating" data-rating="0">
                    <span class="star" data-value="1">&#9733;</span>
                    <span class="star" data-value="2">&#9733;</span>
                    <span class="star" data-value="3">&#9733;</span>  
                    <span class="star" data-value="4">&#9733;</span>
                    <span class="star" data-value="5">&#9733;</span>
                </div>
                <p>Current Rating: <span id="currentRating">{{product.RATINGS}}</span> stars</p>
            
            
            </div>
              <!-- end star -->
              <div class="new">
                <span>
                  New
                </span>
              </div>
            </a>
          </div>
        </div>
        
        {%endfor%}
      <div class="btn-box">
        <a href="">
          View All Products
        </a>
      </div>
    </div>
  </section>

  <!-- end shop section -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>


 const starss = document.querySelectorAll('.star');
 const ratings = document.getElementById("currentRating").textContent;
 starss.forEach((star,index)=>{
  if( index< parseInt(ratings)){
    console.log(index);
    console.log(ratings)
    star.classList.add('active');
  }
 
 });




    function token() {
        const hiddenInputs = document.getElementsByName('csrfmiddlewaretoken');
        const firstHiddenInput = hiddenInputs[0];
        return firstHiddenInput.value;
    }

    let stars = document.querySelectorAll('.star');
    let rating = 0;

    stars.forEach((s, i) => {
        s.addEventListener('click', function() {
            rating = i + 1;
            stars.forEach((star, index) => {
                if (index <= i) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
            document.getElementById('currentRating').innerHTML = rating;
            const productId = document.getElementById('pro').textContent;
            // Trigger AJAX request when a rating is clicked
            sendRatingToBackend(rating,productId);
        });
    });

    function sendRatingToBackend(rating,productId) {
        $.ajax({
            type: 'POST',
            url: "{% url 'submit_rating' %}",
            headers: {
                'X-CSRFToken': token()
            },
            data: { 'rating': rating,
            'productid':productId  },

            success: function(response) {
                console.log('Rating submitted successfully:', response);
                // Handle success response if needed
            },
            error: function(error) {
                console.error('Error:', error);
                // Handle error if needed
            }
        });
    }
</script>



{%endblock%}
